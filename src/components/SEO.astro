---
export interface Props {
  title?: string;
  description?: string;
  canonical?: string;
  image?: string;
  imageAlt?: string;
  noindex?: boolean;
  type?: 'website' | 'article';
  publishedTime?: string;
  modifiedTime?: string;
  author?: string;
  tags?: string[];
  category?: string;
}

const {
  title,
  description,
  canonical,
  image,
  imageAlt,
  noindex = false,
  type = 'website',
  publishedTime,
  modifiedTime,
  author,
  tags,
  category,
} = Astro.props;

// Site defaults
const siteTitle = 'Bruce Denham - Senior Technical Writer & DX Engineer';
const siteDescription = 'Adobe award nominee with 30+ years turning complex concepts into clear, human experiences. Developer documentation, CLI tools, and technical writing excellence.';
const siteUrl = 'https://bruuce.com';
const defaultImage = `${siteUrl}/images/bruce-denham-og-card.jpg`;

// Build final values
const finalTitle = title ? `${title} | Bruce Denham` : siteTitle;
const finalDescription = description || siteDescription;
const finalCanonical = canonical || `${siteUrl}${Astro.url.pathname}`;
const finalImage = image ? `${siteUrl}${image}` : defaultImage;
const finalImageAlt = imageAlt || 'Bruce Denham - Technical Writer & Developer Experience Engineer';

// JSON-LD structured data
const jsonLd = {
  '@context': 'https://schema.org',
  '@type': type === 'article' ? 'Article' : 'WebSite',
  name: finalTitle,
  description: finalDescription,
  url: finalCanonical,
  ...(type === 'article' && {
    headline: title,
    author: {
      '@type': 'Person',
      name: author || 'Bruce Denham',
      url: siteUrl,
    },
    publisher: {
      '@type': 'Person',
      name: 'Bruce Denham',
      url: siteUrl,
    },
    ...(publishedTime && { datePublished: publishedTime }),
    ...(modifiedTime && { dateModified: modifiedTime }),
    ...(category && { articleSection: category }),
    ...(tags && { keywords: tags.join(', ') }),
  }),
};
---

<!-- Primary Meta Tags -->
<title>{finalTitle}</title>
<meta name="title" content={finalTitle} />
<meta name="description" content={finalDescription} />
<link rel="canonical" href={finalCanonical} />

<!-- Robots -->
{noindex && <meta name="robots" content="noindex, nofollow" />}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type} />
<meta property="og:url" content={finalCanonical} />
<meta property="og:title" content={finalTitle} />
<meta property="og:description" content={finalDescription} />
<meta property="og:image" content={finalImage} />
<meta property="og:image:alt" content={finalImageAlt} />
<meta property="og:site_name" content="Bruce Denham" />

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:url" content={finalCanonical} />
<meta property="twitter:title" content={finalTitle} />
<meta property="twitter:description" content={finalDescription} />
<meta property="twitter:image" content={finalImage} />
<meta property="twitter:image:alt" content={finalImageAlt} />
<meta property="twitter:creator" content="@brucedenham" />

<!-- Article specific meta tags -->
{type === 'article' && publishedTime && (
  <meta property="article:published_time" content={publishedTime} />
)}
{type === 'article' && modifiedTime && (
  <meta property="article:modified_time" content={modifiedTime} />
)}
{type === 'article' && author && (
  <meta property="article:author" content={author} />
)}
{type === 'article' && category && (
  <meta property="article:section" content={category} />
)}
{type === 'article' && tags && tags.map(tag => (
  <meta property="article:tag" content={tag} />
))}

<!-- JSON-LD Structured Data -->
<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

<!-- Additional SEO enhancements -->
<meta name="author" content={author || 'Bruce Denham'} />
<meta name="generator" content="Astro" />
<meta name="theme-color" content="#0066CC" />
<meta name="color-scheme" content="dark light" />

<!-- Preconnect to external domains for performance -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
