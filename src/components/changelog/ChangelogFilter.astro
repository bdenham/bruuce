---
const allComponents = [
  'Cart',
  'Checkout',
  'Order',
  'Payment Services',
  'Product details',
  'Storefront Compatibility Package',
  'User auth',
  'User account'
];
---

<div class="changelog-filter">
  <div class="filter-group">
    <label for="component-filter">Filter by component:</label>
    <select id="component-filter" class="filter-select">
      <option value="">All components</option>
      {allComponents.map(component => (
        <option value={component}>{component}</option>
      ))}
    </select>
  </div>
</div>

<div id="no-entries-message" class="no-entries-message" style="display: none;">
  A changelog for that component does not exist.
</div>

<script>
  const componentFilter = document.getElementById('component-filter') as HTMLSelectElement | null;
  const entries = document.querySelectorAll<HTMLElement>('.changelog-entry');
  const noEntriesMessage = document.getElementById('no-entries-message');

  function filterEntries() {
    if (!componentFilter || !noEntriesMessage) return;

    const selectedComponent = componentFilter.value;
    let visibleEntries = 0;

    entries.forEach(entry => {
      const components = entry.getAttribute('data-components')?.split(',') || [];
      const componentMatch = !selectedComponent || components.includes(selectedComponent);

      if (entry instanceof HTMLElement) {
        entry.style.display = componentMatch ? 'block' : 'none';
        if (componentMatch) visibleEntries++;
      }
    });

    // Show/hide the no entries message
    noEntriesMessage.style.display = selectedComponent && visibleEntries === 0 ? 'block' : 'none';
  }

  if (componentFilter) {
    componentFilter.addEventListener('change', filterEntries);
  }
</script>