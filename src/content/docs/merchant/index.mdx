---
title: Multistore
description: Verify that you have completed all recommended steps before launching your Adobe Commerce on Edge Delivery Services storefront project.
---

import { Code } from '@astrojs/starlight/components';
import FileTree from '@components/FileTree.astro';
import OptionsTable from '@components/OptionsTable.astro';
import Tasks from '@components/Tasks.astro';
import Task from '@components/Task.astro';

## Adobe Commerce Configuration

By design, Adobe Commerce instances have a hierarchy of websites, stores, and store views. Each store available to customers is presented according to a specific view. A store has a single default view, and merchants can add additional store views to support different languages and currencies. Merchants can continue to add new Store View and language packages and set up currency following existing Adobe Commerce practices.

## Multistore

Multistore refers to a streamlined architecture that enables managing multiple stores with unique catalogs and localization while leveraging a shared code base and unified content delivery.

## Content Hierarchy structure

The content hierarchy must follow Edge Delivery Service best practices, emphasizing a single-tier structure:

**Language**: Content is organized primarily by language, enabling global reuse and minimizing duplication. For example, English (`/en/`) serves as the default language folder.

**Market/Region**: Regional or market-specific configurations and overrides are stored within each language folder. For instance `/en/` for the US Market or `/en_ca/` for Canada.

Each language folder contains configs, placeholders, and document pages.

- **Environment Configs**: `configs.xls`, defining API endpoints, headers, and other environment-specific data.
- **Placeholders**: `placeholders.xls`, storing reusable tokens for text and UI components.
- **Documents**: `index.docx`, content for your pages. 

### Content Hierarchy
- **index.docx** → index.html
- **configs.xlsx** → configs.json
- **placeholders.xlsx** → placeholders.json

## Big Picture

The file structure of a multistore is shown here.

<FileTree>

- **en/** _-- English Store (Default root language)_
  - configs.xls _-- Defines API endpoints, headers, and other environment-specific data._
  - placeholders.xlsx _-- Stores reusable tokens for text and UI components._
  - index.docx _-- The home page of the English store._
- **en_ca/** _-- English Canadian Store_
  - configs.xls _-- Environment specific data for the English Canadian Store_
  - placeholders_overrides.xlsx _-- Entries that override the English store._
  - index.docx _-- The home page of the English Canadian store._
- fstab.yaml _-- Sets mountpoints and folder mapping._
- metadata.xlsx _-- URL, root path, and placeholder mapping for Multistore_
- store-switcher.docx _-- Manages the list of stores and their URL to render in the UI_

</FileTree>

### Configs.xlsx

From the language folder, `/en_ca/` create a `configs.xls` file.

### Placeholders

From the language folder, `/en_ca/` create a `placeholders.xlsx` or `placeholders_overrides.xlsx` file.

| Key | Value |
|---|---|
| `Cart.Cart.heading` | `Shopping Cart ({count})` |
| `Cart.Cart.editCart` | `Edit` |

### Folder Mapping

Add folder mapping to the PDP in the `fstab.yaml` file of the project – this is the only code change required and must be merged into the `main` branch to take effect.

From the root of your project, create a `fstab.yaml` file.

export const exampleCode = `mountpoints:
  /: https://example.mountpoint.com/:f:/r/sites/myproject

folders:
  /products/: /products/default
  /en/products/: /en/products/default
  /en_ca/products/: /en_ca/products/default`;
export const fileName = 'fstab.yaml';
export const highlights = ['file', 'CMS'];

<Code code={exampleCode} lang="yaml" title={fileName} mark={highlights} />

### Metadata

Overrides Commerce endpoint configs and placeholders based on the `root` page metadata provided. Otherwise, it defaults to the base `/`.

From the root of your project, create a `metadata.xlsx` file.

| URL | root | placeholders |
|---|---|---|
| /en/** | /en/ | /en/placeholders.json |
| /en_ca/** | /en_ca/ | /en/placeholders.json<br/>/en_ca/placeholders-overrides.json |

**root**: Path to the directory where `configs.xlsx` files are located. Default is `/`.

**placeholders**: Path to the placeholders.json file to use. The default is `/placeholders.json`. Adding a new line with another path in this value specifies an override file. Both files will be fetched, and the values in the second file will override those in the first.

Metadata are managed as a bulk (https://www.aem.live/docs/bulk-metadata) in `metadata.xlsx`.

### Store Switcher

Manage a list of Stores listed in the Store switcher with a single file:

From the root of your project, create a `store-switcher.docx` file. The contents of this file should include a bullet list that can be nested that includes the name of your store to display with an active link to the store.


## Functions
When localizing links, it's recommended that the path to each link on your site should be maintained within the content in Google Drive or Microsoft SharePoint.

However, if you want it taken care of, with less control, there is a utility function that can help: `decorateLinks`.

For links within your Drop-Ins, they will need to be localized. For that, us the `rootLink` function to wrap your links.

These functions can be found in `/scripts.scripts.js`.

### decorateLinks

The `decorateLinks` function is useful if you'd like to handle prepending all your content links (links within Google Drive or Microsoft SharePoint) automatically. This function prepends the root path of each language to the link that it receives.

```js
/**
 * Decorates links.
 * @param {Element} main The main element
 */
export function decorateLinks(main) {
  const root = getRootPath();
  if (root === '/') return;
  const links = main.querySelectorAll('a');

  links.forEach((link) => {
    const url = new URL(link.href, window.location.origin);
    const { pathname } = url;

    // If the link is already localized, do nothing
    if (pathname.startsWith('//') || pathname.startsWith(root)) return;

    if (
      link.href.startsWith('/')
      || link.href.startsWith(window.location.origin)
    ) {
      link.href = `${root}${url.pathname.substring(1)}${url.search}${url.hash}`;
    }
  });
}
```

If you'd like to use this, add it to your main element. The Boilerplate handles it like this, within `scripts/scripts/js`, and is not enabled by default.


```js
/**
 * Decorates the main element.
 * @param {Element} main The main element
 */
// eslint-disable-next-line import/prefer-default-export
export function decorateMain(main) {
  // hopefully forward compatible button decoration
  decorateButtons(main);
  decorateIcons(main);
  buildAutoBlocks(main);
  decorateSections(main);
  decorateBlocks(main);
  // decorateLinks(main); // author can decide when to localize links
}
```

### rootLink

This function should be used within Blocks, to localize links on a code-base level, coming from a drop-in for loading scripts, styles, or linking to other pages within a drop-in. This approach is necessary for maintaining consistency across different languages and store views. This function prepends the root path of each language to the link that it receives.

```js
/**
 * Decorates links.
 * @param {string} [url] url to be localized
 */
export function rootLink(link) {
  const root = getRootPath().replace(/\/$/, '');

  // If the link is already localized, do nothing
  if (link.startsWith(root)) return link;
  return `${root}${link}`;
}
```

## Step-by-Step

In this example, we will add a new English Canadian Store View.

<Tasks>

<Task>

### Add a New Store

1. Create a new root folder for the desired market. (e.g. `/en_ca/` for Canada)
2. Add files for your configs, placeholders, and document pages

</Task>

<Task>

### Update Content Files

1. Translate or localize content files in the `/en_ca/` folders
2.  Ensure all labels in `placeholders.xlsx` are accurately translated into the desired language.

</Task>

<Task>

### Update Environment Configurations

1. Modify `configs.xlsx` to include appropriate Commerce API endpoints and headers such as the store view.

</Task>

<Task>

### Set Metadata to the Chosen Market's Path

1. Create `metadata.xlsx` to the root of your project.
2. Set the **root** values to the directory where `configs.xlsx` files are located. Default is `/`.
3. Set the **placeholders** to the `placeholders.json` file to use. Default is `/placeholders.json`.
4. Optional: add **placeholders_overrides.json` file if you'd like to override the first file.

</Task>

<Task>

### Add Folder Mapping

1. In the `fstab.yaml` file of the project add folder mapping to the PDP page.

:::note[Code Change Required]
This is the only code change required and must be merged into the `main` branch to take effect.
:::

</Task>

<Task>

### Preview and Validate:

1. Preview the updated folder `/en_ca/` with AEM Sidekick.
2. Validate the storefront experience by accessing the new language/region and testing the rendering, navigation, and data accuracy.
3. Publish the updated folder with the AEM Sidekick folder when ready.

</Task>

</Tasks>


 