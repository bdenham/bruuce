---
title: Initializer
description: Initializer is a class that helps you initialize your package.
---

import Aside from '@components/Aside.astro';
import Badge from '@components/overrides/Badge.astro';

```typescript
// my-domain-package/initializer.ts

import { Initializer } from '@adobe/elsie/lib';
// import { events } from '@adobe/event-bus';

type ConfigProps = {};

export const initialize = new Initializer<ConfigProps>({
  init: async (config) => {
    const defaultConfig = {};
    initialize.config.setConfig({ ...defaultConfig, ...config });
  },

  listeners: () => [
    // events.on('authenticated', (authenticated) => {
    //   console.log('authenticated', authenticated);
    // }),
  ],
});

export const config = initialize.config;
```

```typescript
// Host Site
import { initializers } from '@dropins/elsie/initializer.js';
import { initialize as pkg } from 'my-domain-package/initializer.js';

// Register Packages
initializers.register(pkg, { ...config });

// Mount Initializers
window.addEventListener('load', initializers.mount);
```

## `setImageParamKeys(params)`

The `setImageParamKeys` method is part of the initializers module in the `@dropins/tools` package. It allows you to set image parameters globally for all drop-in components that use the [Image](/sdk/components/image/) component. CDN-based image optimization services, such as Fastly and Cloudflare, rely on these parameters to optimize images.

### Default behavior

Since Fastly is the default CDN for Adobe Commerce on Cloud, drop-in components add the following Fastly-style parameters to all image URLs by default:

- `width`
- `height`
- `auto`
- `quality`
- `crop`
- `fit`

Example:

```text
/media/catalog/product/adobestoredata/ADB150.jpg?auto=webp&quality=80&crop=false&fit=cover&width=960&height=1191`
```

Technical details about CDN-based image optimization differ depending on your backend Adobe Commerce solution:

- <Badge tooltip="Applies to Adobe Commerce on Cloud projects (Adobe-managed PaaS infrastructure) and on-premises projects only." text="PaaS only" variant="note" href="https://experienceleague.adobe.com/en/docs/commerce/user-guides/product-solutions" /> Fastly is the default CDN-based image optimization service for Adobe Commerce on Cloud projects. Fastly-style parameters are used by default unless overridden via `setImageParamKeys`.
  
- <Badge tooltip="Applies to Adobe Commerce as a Cloud Service and Adobe Commerce Optimizer projects only (Adobe-managed SaaS infrastructure)." text="SaaS only" variant="success" href="https://experienceleague.adobe.com/en/docs/commerce/user-guides/product-solutions" /> Cloudflare is the default CDN-based image optimization service for Adobe Commerce as a Cloud Service and Adobe Commerce Optimizer projects. Fastly-style parameters are used but are proxied through a [Cloudflare Worker](https://developers.cloudflare.com/images/transform-images/transform-via-workers) to transform the parameters to Cloudflare-style parameters. Overriding the default parameters using `setImageParamKeys` may interfere with the proxy transformation and lead to unexpected results.

<Aside type="tip" title="Override defaults">
If necessary, you can override these parameters with the `setImageParamKeys` method. For example, if you are using a CDN provider that requires different parameters or URL patterns.
</Aside>

### Parameters

- `params` - `{ [key: string]: string | ((data: any) => [string, string]) }`
  - An object of key-value pairs to map image parameters to their respective keys in the URL.
  - The value can be a string or a function that takes the parameter value as an argument and returns a tuple of the new key and transformed value.

### Functionality

- If a parameter key is provided via `setImageParamKeys`, it is used in generating image URLs instead of the default Fastly parameters.
- If a parameter key is not provided via `setImageParamKeys`, it is omitted from the generated image URLs.
- If a mapped key is a function and it is not specified as a parameter in the Image component, it is called with `null`. It should return a tuple of the key and value.
- If a mapping callback is provided, the callback is called with the parameter value (if it exists) and should return a tuple of the new key and transformed value.
- If a mapping callback returns `null`, the parameter is omitted from the generated image URLs.

### Usage

Call the `setImageParamKeys()` function before the `mountImmediately()` function in the application layer.

```javascript
// Set global image parameters
initializers.setImageParamKeys({
  // Re-map the width parameter to imgWidth
  width: 'imgWidth',
  // Transform the quality parameter
  quality: (value) => ['imgQuality', value * 100],
  // Add an additional parameter to the image URL
  extraParam: () => ['extraParam', 'extraValue'],
});

// Register and Mount Initializers immediately
initializers.mountImmediately(pkg.initialize, {
  // other configurations...
});
```

Now, when a dropin uses the Image component to render an image with a width of 300 pixels and quality value of 0.8:

```jsx
<Image
  loading={'lazy'}
  src={'https://example.com/image.jpg'}
  alt={'Example Image'}
  width="300"
  height="300"
  params={{ width: 300, quality: 0.8 }}
/>
```

It renders the following image element:

```html
<img
  loading="lazy"
  src="https://example.com/image.jpg"
  srcset="https://example.com/image.jpg?imgWidth=300&imgQuality=80&extraParam=extraValue 768w, https://example.com/image.jpg?imgWidth=300&imgQuality=80&extraParam=extraValue 1024w, https://example.com/image.jpg?imgWidth=300&imgQuality=80&extraParam=extraValue 1366w, https://example.com/image.jpg?imgWidth=300&imgQuality=80&extraParam=extraValue 1920w"
  alt="Example Image"
  width="300"
  height="300"
/>
```

In this example, the width parameter is mapped to imgWidth and the value of the quality parameter is modified and mapped to imgQuality.

## `setGlobalLocale(locale)`

The `setGlobalLocale()` method is part of the initializers module in the `@dropins/tools` package.
It allows you to set a global locale for all drop-ins that use locale-sensitive components like the Price component.

### Default Behavior

By default, components use the browser's locale or fallback to 'en-US' if no global locale is set.

### Parameters

- `locale` - `string` - The locale string (e.g., 'en-US', 'es-MX', 'fr-FR', 'de-DE').

### Functionality

- If a global locale is set via `setGlobalLocale()`, it will be used by components that support locale configuration.
- Component-specific locale props will take precedence over the global locale.
- If no global locale is set, components will fall back to the browser's locale or a default locale.

### Usage

Call the `setGlobalLocale()` function before the `mountImmediately()` function in the application layer.

```javascript
// Set global locale for consistent formatting across all drop-ins
initializers.setGlobalLocale('fr-FR');

// Register and Mount Initializers immediately
initializers.mountImmediately(pkg.initialize, {
  // other configurations...
});
```

Now, when a dropin uses the Price component without specifying a locale prop:

```jsx
<Price
  amount={100}
  currency="EUR"
/>
```

It will render with the global locale (fr-FR) formatting:

```html
<span class="dropin-price dropin-price--default dropin-price--small dropin-price--bold">
  100,00 €
</span>
```

If the same component is used with a specific locale prop, that will take precedence:

```jsx
<Price
  amount={100}
  currency="EUR"
  locale="en-US"
/>
```

It will render with the specified locale (en-US) formatting:

```html
<span class="dropin-price dropin-price--default dropin-price--small dropin-price--bold">
  €100.00
</span>
```