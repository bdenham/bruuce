---
title: AEM Assets Integration
description: Guide for enabling AEM Assets support in Commerce dropins and boilerplate
sidebar:
  order: 60
---

# AEM Assets Integration

This guide outlines the changes required to enable AEM Assets support in Commerce dropins and the boilerplate. The integration is implemented via extensibility with image slots, allowing dynamic replacement of images at render time.

## Overview

The AEM Assets integration was developed as part of the **ACAP-809 - EDS + Assets drop-in compatibility** epic. The implementation uses image slots - small pieces of UI that allow injecting or replacing content from the outside (boilerplate) at render time.

### Key Concepts

**Image Slots**: On every usage of an Image (and ImageSwatch) in different UI components/containers, a slot has been introduced. If these slots are not provided with custom content, the component displays the default image that would normally be shown.

**Contextual Data Access**: When slots are used within components, they have access to contextual data related to their parent entity:
- The Thumbnail slot within a cart item component can access data about that specific cart item
- The CarouselMainImage slot on a Product Detail Page (PDP) can access data about the specific product being displayed
- Slots receive the "image information" (image properties) of the default image that would be displayed if no custom content was provided

## Implementation Groups

The changes can be grouped into three categories:

1. **Dropins (and SDK)**
2. **Boilerplate**  
3. **Configuration**

## Dropins and SDK Changes

### Storefront SDK

The Storefront SDK required updates to support image slots across all dropins.

#### Injectable Image Swatches

Image swatches needed slot support for configurable products. These swatch images are used for attributes like:
- Materials
- Design Patterns  
- Gift Wrapping
- Textures

**Related Tickets:**
- **USF-2156** - Allow to replace Image in Image Swatch via VNode ✅
- **USF-2210** - Make image swatch vnode be a render prop ✅

#### Configurable HTML Tag in Slot API

The Slot API was enhanced to prevent invalid HTML by allowing specification of which HTML tag should be used when defining a Slot.

**Related Ticket:**
- **USF-2209** - Make Slot API wrapper tag configurable ✅

### Dropin-Specific Changes

#### Cart Drop-in

**Changes Applied:**
- **CartSummaryGrid & MiniCart**: Introduce Thumbnail Slots
- **GiftOptions**: Introduce Swatch Image Slot  
- **All Thumbnail Slots**: Extend Slot Context

**Related Tickets:**
- **USF-2127** - Allow replacing images (MiniCart and CartSummaryGrid Containers) ✅
- **USF-2148** - Refactor ImageSwatch for Cart Dropin to be able to render it via slots ✅
- **USF-2233** - Refactor cart image slots to pass default image props as context ✅

#### PDP Drop-in

**Changes Applied:**
- **ProductGallery & ProductOptions**: Introduce many Image Slots
- **ProductDetails**: Deprecate legacy container

**Related Ticket:**
- **USF-2126** - Allow replacing images (PDP Dropin) ✅

#### Account Drop-in

**Changes Applied:**
- **OrdersList**: Introduce OrderItemImage Slot

**Related Ticket:**
- **USF-2128** - Allow replacing images (Account Dropin) ✅

#### Order Drop-in

**Changes Applied:**
- **OrderProductListContent**: Image slots support
- **ReturnReasonForm**: Image slots support
- **ReturnListContent**: Image slots support  
- **ShippingStatusCard**: Image slots support

**Related Ticket:**
- **USF-2229** - Allow replacing images (Order Dropin) ✅

#### Recommendations Drop-in

This dropin was released with image slots support out of the box, including:
- **Thumbnail**: Available in ProductList component

## Boilerplate Changes

### Legacy Widget Compatibility

While transitioning to composable dropins, temporary workarounds were implemented for legacy widgets:

- **PLP**: ACAP-828 - PLP widget compatibility ✅
- **PREX**: ACAP-1002 - PREX compatibility ✅

:::note
These legacy changes don't require documentation as they have been replaced with their dropin versions.
:::

### Drop-in Block Support

AEM Assets support is implemented incrementally via stacked PRs:

#### Completed Implementations

| Component | Ticket | Status |
|-----------|--------|---------|
| **AEM Assets Utilities** | ACAP-1017 - Create Plugin In Boilerplate For AEM Assets | ✅ |
| **PDP** | ACAP-829 - PDP dropin/boilerplate compatibility images | ✅ |
| **Cart** | ACAP-1004 - Cart drop-in/boilerplate compatibility | ✅ |
| **Account** | ACAP-942 - My Account drop-in boilerplate compatibility | ✅ |
| **Order** | ACAP-1027 - Order drop-in boilerplate compatibility | ✅ |
| **Checkout** | ACAP-1032 - Enable AEM Assets support in Checkout drop-in of Boilerplate | ✅ |
| **PREX** | ACAP-1057 - PREX dropin support | ✅ |

:::info
The AEM Assets utilities were initially created in the boilerplate but have since been moved to the StorefrontSDK.
:::

## Configuration

To enable AEM Assets support, add the following configuration to your `config.json` file:

```json
{
  "public": {
    "default": {
      "commerce-assets-enabled": "true"
    }
  }
}
```

### Configuration Options

- **Value**: `"true"` (case insensitive string) or `true` (boolean)
- **Purpose**: Indicates whether the boilerplate should run AEM Assets compatibility code

## Expected Behaviors

The following table shows expected behavior for different configuration combinations:

| Image Source | Config Value | Result |
|--------------|--------------|---------|
| **Commerce** | `true` | ⚠️ Only hosted images returned from APIs, but config indicates AEM Assets. Code should not fail (passthrough for dropins only) |
| **Commerce** | `false` | ✅ Hosted images returned and config indicates AEM Assets disabled. Images display correctly |
| **AEM Assets** | `true` | ✅ AEM Assets images returned and config indicates AEM Assets enabled. Images display correctly |
| **AEM Assets** | `false` | ❌ AEM Assets images returned but config indicates disabled. Images may appear broken or show configured placeholders |

:::warning Important
When AEM Assets images are returned but the config is set to `false`, images may not display correctly and could appear broken if optimization parameters conflict with AEM Assets expectations (returns 400 error).
:::

## Future Work

New dropins in development will implement image slots support by default. Teams should coordinate to ensure boilerplate block support is implemented alongside dropin development.

**Dropins with Image Slots Support:**
- Product Recommendations (released with OOTB support)

## Related Documentation

- [Dropin Overview](/dropins/all/)
- [Configuration Setup](/setup/configuration/)
- [Troubleshooting](/troubleshooting/faq/) 