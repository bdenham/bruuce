---
title: Order Cancellation
description: Learn the Order Cancellation workflow.
---

import Aside from '@components/Aside.astro';
import Diagram from '@components/Diagram.astro';
import OptionsTable from '@components/OptionsTable.astro';
import { Steps } from '@astrojs/starlight/components';
import Tasks from '@components/Tasks.astro';
import Task from '@components/Task.astro';

The Order dropin allows both logged in and guest users to cancel an order.

In this tutorial, we will show:

- the prerequisites to be able to cancel an order,
- the cancellation workflow, and
- implementation details of some components involved in the process.

## Prerequisites

To be able to cancel an order, you need to have the configuration enabled in the backend.
You can find it in the backoffice under _Stores > Configuration > Sales > Sales > Order Cancellation_.

There are the following configurations:

<OptionsTable
  compact
  options={[
    ['Configuration', 'Description'],
    [
      'Order cancellation through GraphQL',
      'It is a boolean. When it is set to `true`, the order cancellation will be enabled.',
    ],
    [
      'Order cancellation reasons',
      'It is an array of reasons that can be selected by the user when cancelling an order.',
    ],
  ]}
/>

:::note[Note]
Note: There is a default list of reasons, but you can customise according to your needs.
:::

<Diagram caption="The order cancellation configurations you can customise in the backoffice">
  ![Cancellation configurations in the
  backoffice](@images/dropins/order/cancellation-prerequisites.png)
</Diagram>

## Workflow

The order cancellation workflow is as follows:

  <Steps>
1. Select an order to cancel.
1. Submit the cancellation form after selecting a cancellation reason.
1. In case it is a *logged-in user*, the order is `Canceled` immediately. But when it is a _guest user_, the order remains in status `Pending` until the user confirms the cancellation.

  </Steps>

Let's review the workflow in more detail:

<Tasks>
  <Task>
  ### Select an order to cancel

A _logged-in user_ can select an order to cancel in two different ways:

- from the _Order History_ page,

<Diagram caption="Order history page listing orders placed by a logged in user .">
  ![Logged-in user - Order history page](@images/dropins/order/cancellation-order-history.png)
</Diagram>
- using the *Order Search* form to load the order to request the cancellation afterwards.
<Diagram caption="Form presented to the the user to search for an order">
  ![Order Search form to search for an order](@images/dropins/order/order-search.png)
</Diagram>

  <Aside type="caution" title="Guest users">
    A *guest user* do not have access to the *Order History* page. Therefore, the only way to access
    an order is by using the *Order Search* form.
  </Aside>
  </Task>

  <Task>
  ### Submit the cancellation form

The user is able to select a cancellation reason and submit the form:

<Diagram caption="Form presented to the guest user with different cancellation reasons.">
  ![Guest user selects a cancellation reason](@images/dropins/order/cancellation-form.png)
</Diagram>

After submitting the form, the changes are reflected on the _Order Status_ page:

<Diagram caption="Order is canceled straight away for logged-in users.">
  ![Cancellation is performed straight away for logged-in
  users](@images/dropins/order/cancellation-performed.png)
</Diagram>

<Diagram caption="Guest user is notified that cancellation has been requested.">
  ![Cancellation has been requested for a guest
  user](@images/dropins/order/cancellation-requested.png)
</Diagram>

  </Task>

  <Task>
    ### Confirm order cancellation

    The guest order remains in status `Pending` until the user clicks the link in the email to confirm the cancellation.

    <Aside type="choose" title="Confirm Your Main Website Store Order Cancellation">
      It seems that you'd like to cancel your order #000000001. If this is correct, please _click here_ to confirm your cancellation request.

      If you have questions about your order, you can email us at _support@example.com_.
    </Aside>
    Once clicked, the order becomes `Canceled` and _Order Status_ page is updated accordingly.

  </Task>

</Tasks>

## Implementation details

Find below implementation details of some components involved in the order cancellation process:

### Order History page

The _Order History_ page uses the `OrderProductListContent` component to render the list of orders placed by the user.
It iterates over the list of orders and uses the `CartSummaryItem` component to render each order item.
The order item are instances of the `OrderItemModel`, which contains all the necessary properties of an order item.

See a sample of the `OrderProductListContent` implementation below:

```jsx
...
<ul className="order-order-product-list-content__items">
  {item.list?.map((product: OrderItemModel) => (
    <li
      data-testid="order-product-list-content-item"
      key={product.id}
    >
      <CartSummaryItem
        loading={loading}
        product={product}
        itemType={item.type}
        taxConfig={taxConfig}
        translations={translations}
        showConfigurableOptions={showConfigurableOptions}
        routeProductDetails={routeProductDetails}
      />
    </li>
  ))}
</ul>
...
```

### Order Search form

The `OrderSearchForm` component is responsible for rendering the form to search for an order.
It basically receives the following parameters:

- `fieldsConfig`: an array of fields to be rendered in the form
- `loading`: a boolean to indicate if the form is loading
- `inLineAlert`: after submitting the form, an inline alert is shown with the result of the operation (success, warning, error) with its respective message
- `onSubmit`: a function to be called when the form is submitted and a flag to indicate if the form is valid

See a sample of the implementation below:

```jsx
...
{inLineAlert.text ? (
  <InLineAlert
    data-testid="orderAlert"
    className={'order-order-search-form__alert'}
    type={inLineAlert.type}
    variant="secondary"
    heading={inLineAlert.text}
    icon={<Icon source={WarningFilled} />}
  />
) : null}

<Form
  className={'order-order-search-form__wrapper'}
  name="orderSearchForm"
  loading={loading}
  fieldsConfig={fieldsConfig}
  onSubmit={onSubmit}
>
  <div className="order-order-search-form__button-container">
    <Button
      className={'order-order-search-form__button'}
      size={'medium'}
      variant={'primary'}
      key={'logIn'}
      type={'submit'}
      disabled={loading}
    >
      <Text id={'Order.OrderSearchForm.button'} />
    </Button>
  </div>
</Form>
...
```

### Order cancellation form

The `OrderCancel` component renders the `OrderCancelForm` inside a modal.
This modal receives two parameters:

- `orderRef`, to identify the order, and
- `cancelReasons`, with all possible cancellation reasons.

See the details below:

```jsx
...
<Modal
  centered={true}
  size="medium"
  onClose={handleClose}
  className={'order-order-cancel__modal'}
  title={
    <h2 className={'order-order-cancel__title'}>
      <Text id={'Order.OrderCancelForm.title'} />
    </h2>
  }
  data-testid="order-cancellation-reasons-modal"
>
  <OrderCancelForm
    orderRef={orderRef}
    cancelReasons={transformCancelReasons(orderCancellationReasons)}
  />
</Modal>
...
```

The `OrderCancelForm` component is responsible for:

- rendering the form with the different cancellation reasons and submission button
- handling the form submission
- showing the appropriate error messages in case of failure after submitting the form

```jsx
...
{isErrorVisible && (
  <InLineAlert
    heading={translations.ErrorHeading}
    description={translations.ErrorDescription}
  />
)}
<div className="order-order-cancel-reasons-form__text">
  <Text id={'Order.OrderCancelForm.description'} />
</div>
<Picker
  name="cancellationReasons"
  floatingLabel={translations.orderCancellationLabel}
  defaultOption={cancelReasons[0]}
  variant="primary"
  options={cancelReasons}
  value={String(selectedReason)}
  handleSelect={handleReasonSelect}
  required={true}
  data-testid="order-cancellation-reasons-selector"
  {...pickerProps}
/>
<div className="order-order-cancel-reasons-form__button-container">
  <Button
    variant="primary"
    data-testid="order-cancel-submit-button"
    {...submitButtonProps}
  >
    <Text id={'Order.OrderCancelForm.button'} />
  </Button>
</div>
...
```

### Order Status page

The _Order Status_ page uses the `OrderStatusContent` component to render the order with all its properties and the available actions.

See a sample of the `OrderStatusContent` implementation below:

```jsx
...
<Card className="order-order-status-content" variant="secondary">
  <Header title={headerTitle} />
  <div className="order-order-status-content__wrapper">
    <div
      className={classes([
        'order-order-status-content__wrapper-description',
        [
          'order-order-status-content__wrapper-description--actions-slot',
          !!slots?.OrderActions,
        ],
      ])}
    >
      <p>{isReturnPage ? returnMessage : orderMessage}</p>
    </div>
    <OrderActions
      orderData={orderData}
      slots={slots}
      routeCreateReturn={routeCreateReturn}
      routeOnSuccess={routeOnSuccess}
      onError={onError}
    />
  </div>
</Card>
...
```

After performing any action, the _Order Status_ page is re-rendered, so that, it reflects the new status and the available actions.
Also, the appropriate message is shown to the user, depending on the action performed.
