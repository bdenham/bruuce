---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import SEO from '../../components/SEO.astro';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  // Filter out draft posts in production
  const publishedPosts = blogPosts.filter((post) => !post.data.draft);
  return publishedPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

// SEO data
const seoTitle = post.data.seo?.title || post.data.title;
const seoDescription = post.data.seo?.description || post.data.excerpt;
const publishedTime = post.data.date.toISOString();
---

<BaseLayout
  title={`${post.data.title} - Bruce Denham`}
  description={post.data.excerpt}
  showBackLink={true}
  backLinkText="← Back to Blog"
  backLinkHref="/blog/"
  footerText="Thanks for reading! "
  footerLinkText="Browse more posts"
  footerLinkHref="/blog/"
>
  <!-- Enhanced SEO -->
  <SEO
    slot="head"
    title={seoTitle}
    description={seoDescription}
    type="article"
    image={post.data.image}
    imageAlt={post.data.imageAlt}
    publishedTime={publishedTime}
    author={post.data.author}
    canonical={post.data.seo?.canonical}
    noindex={post.data.seo?.noindex}
  />

  <!-- Post metadata -->
  <p class="date animate-in animate-delay-100">
    Published: {
      post.data.date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      })
    }
  </p>

  <!-- Post title -->
  <h1 id="post-title" class="animate-in animate-delay-150">{post.data.title}</h1>

  <!-- Post content -->
  <div class="content animate-in animate-delay-250">
    <Content />
  </div>
</BaseLayout>

<style>
  /* Blog post specific styles */
  .date {
    margin: 0;
    color: var(--accent-primary);
    font-size: 1rem;
  }

  #post-title {
    margin: 1rem 0;
    font-size: 2.5rem;
    line-height: 1.1;
    color: var(--text-primary);
  }

  .post-tags {
    margin: 1rem 0 2rem 0;
  }

  /* Mobile responsive adjustments */
  @media (max-width: 640px) {
    .date {
      font-size: 0.9rem;
    }

    #post-title {
      font-size: 2rem;
      line-height: 1.2;
      margin: 0.75rem 0;
    }

    .post-tags {
      margin: 0.75rem 0 1.5rem 0;
    }
  }

  @media (max-width: 480px) {
    #post-title {
      font-size: 1.75rem;
    }
  }

  /* Blog-specific styles - content typography now in theme.css */

  /* Ensure tags don't interfere with content flow */
  .post-tags :global(.tags-container) {
    position: relative;
    z-index: 1;
  }
</style>
