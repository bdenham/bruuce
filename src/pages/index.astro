---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Card from '../components/ui/Card.astro';
import Section from '../components/ui/Section.astro';
import Grid from '../components/ui/Grid.astro';
import LighthouseGauge from '../components/ui/LighthouseGauge.astro';
import SpeedInsights from '@vercel/speed-insights/astro';

// Get the latest 2 blog posts for the homepage
const blogPosts = await getCollection('blog');
const latestPosts = blogPosts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 2);
---

<BaseLayout
  title="Bruce Denham | Adobe Award-Nominated Technical Writer & DX Engineer"
  description="üèÜ Adobe award nominee with 30+ years transforming complex technical concepts into clear developer experiences. Expert in API docs, SDK documentation, and developer tools at Adobe."
  footerText="Thanks for visiting! Let's build better developer experiences together."
>
  <h1 class="page-title">Bruce <span>Denham</span></h1>
  <p class="subtitle homepage animate-in animate-delay-100">Senior Tech Writer / DX Engineer</p>
  <p class="text-large lead animate-in animate-delay-150">
    üèÜ <strong>Adobe award nominee</strong> with 30+ years turning complex concepts into clear, human
    experiences. I try to help developers learn fast, build smart, and focus on what matters.
  </p>
  <Section title="My Philosophy" class="animate-in animate-delay-250">
    <p>
      I don't just write the docs. I build tools, craft interfaces, and create explanations that
      click. I code. I design. I connect. My mission is helping developers have those "aha" moments
      that turn complexity into clarity and frustration into flow.
    </p>
  </Section>

  <aside class="performance-highlight" aria-labelledby="performance-metrics">
    <h2 id="performance-metrics" class="section-heading">‚ö° Performance Excellence</h2>
    <p>Sub-second performance with exceptional user experience across all devices.</p>

    <!-- Lighthouse Scores Grid -->
    <div class="lighthouse-grid">
      <LighthouseGauge score={100} label="Performance" />
      <LighthouseGauge score={100} label="Accessibility" />
      <LighthouseGauge score={100} label="Best Practices" />
      <LighthouseGauge score={100} label="SEO" />
    </div>

    <!-- Performance Metrics Grid -->
    <div class="performance-metrics">
      <div class="metric-item"><span class="metric-value">~0.3s</span><br />Desktop Load</div>
      <div class="metric-item"><span class="metric-value">~1.0s</span><br />Mobile Load</div>
      <div class="metric-item"><span class="metric-value">0ms</span><br />Blocking Time</div>
      <div class="metric-item"><span class="metric-value">0</span><br />Layout Shift</div>
    </div>

    <a
      href="https://pagespeed.web.dev/analysis?url=https://bruuce.com"
      target="_blank"
      rel="noopener noreferrer"
      class="performance-cta"
    >
      <small class="percentile-text">Verify on PageSpeed Insights ‚Üó</small>
    </a>
  </aside>

  <Section
    title="Quick Navigation"
    class="animate-in animate-delay-200"
    style="--section-title-display: none;"
  >
    <Grid variant="default" gap="medium">
      <Card
        variant="content"
        icon="üìã"
        title="My Resume"
        description="Explore my 30+ years of experience in technical writing and developer experience"
        href="/resume/"
        ariaLabel="View my complete resume"
      />

      <Card
        variant="content"
        icon="üõ†Ô∏è"
        title="My Work"
        description="SDK docs, CLI tools, React apps, and developer experience projects at Adobe and beyond"
        href="/work/"
        ariaLabel="View my professional work and projects"
      />

      <Card
        variant="content"
        icon="üìù"
        title="My Blog"
        description="Insights on developer experience, API documentation, and making complex concepts clear"
        href="/blog/"
        ariaLabel="Read my blog"
      />

      <Card
        variant="content"
        icon="üë®‚Äçüíª"
        title="About Me"
        description="Learn about my journey from Schlumberger to TOPAZ to Adobe as a developer experience strategist"
        href="/about/"
        ariaLabel="Learn more about my background"
      />
    </Grid>
  </Section>

  <Section title="Recent Posts" class="animate-in animate-delay-300">
    <Grid variant="single" gap="medium">
      {
        latestPosts.map((post) => (
          <Card
            title={post.data.title}
            href={`/blog/${post.slug}/`}
            ariaLabel={`Read: ${post.data.title}`}
            period={post.data.date.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            })}
          >
            <p class="post-excerpt">{post.data.excerpt}</p>
          </Card>
        ))
      }
    </Grid>
  </Section>
</BaseLayout>

<!-- Minimal scroll position optimization -->
<script>
  // Only set scroll restoration once to prevent accumulation
  if ('scrollRestoration' in history && history.scrollRestoration !== 'manual') {
    history.scrollRestoration = 'manual';
  }

  // Ensure page starts at top without forced reflows
  window.scrollTo(0, 0);
</script>

<style>
  /* Homepage-specific layout adjustments only */

  /* Mobile-first responsive navigation grid */
  .grid-navigation {
    display: grid;
    grid-template-columns: 1fr; /* Single column on mobile */
    gap: 1rem;
    margin: 2rem 0;
  }

  /* Two columns on tablet and up - mobile-first approach */
  @media (min-width: 640px) {
    .grid-navigation {
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
  }

  /* Performance optimizations for blog posts */
  .blog-posts-container {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  /* Simple styling for blog post content - now using unified .meta class */

  .post-excerpt {
    color: var(--text-secondary);
    line-height: 1.6;
    margin: 0;
  }

  /* Blog post animations now handled by universal .animate-in class */

  /* Mobile override */
  /* Mobile responsive handled by BaseLayout */

  /* Performance Highlight Styles */
  .performance-highlight {
    background: linear-gradient(135deg, var(--bg-card), rgba(0, 170, 255, 0.02));
    border: 2px solid rgba(0, 170, 255, 0.2);
    border-radius: 16px;
    padding: 24px;
    margin: 32px 0;
    /* Performance-friendly page load animation */
    opacity: 0;
    transform: translateY(20px);
    animation: slideInUp 500ms cubic-bezier(0.4, 0, 0.2, 1) forwards;
    animation-delay: 75ms;
    /* Allow full width for performance metrics display */
    max-width: none;
  }

  .performance-header h2 {
    color: var(--text-primary);
    margin: 0 0 8px 0;
    font-size: 1.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    border-bottom: none;
    padding-bottom: 0;
  }

  .performance-header p {
    color: var(--text-tertiary);
    margin: 0 0 20px 0;
    font-size: 1rem;
    font-weight: 400;
  }

  .lighthouse-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 2rem;
  }

  .card-grid-medium {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .metric-item {
    text-align: center;
    padding: 12px;
    background: rgba(0, 170, 255, 0.1);
    border-radius: 8px;
    font-size: 0.8125rem;
    line-height: 1;
    margin-bottom: 0;
  }

  .lighthouse-score {
    text-align: center;
    padding: 8px;
    background: rgba(12, 186, 96, 0.1);
    border: 1px solid rgba(12, 186, 96, 0.2);
    border-radius: 8px;
    font-size: 0.8125rem;
    font-weight: 500;
    line-height: 1.1;
  }

  .lighthouse-value {
    display: block;
    font-size: 1.5rem;
    font-weight: 500;
    color: #0cba60;
    line-height: 1;
    margin-bottom: 2px;
    font-family: monospace;
  }

  .metric-value {
    display: block;
    font-size: 1.25rem;
    font-weight: 500;
    color: var(--accent-primary);
    line-height: 1;
    margin-bottom: -2px;
    font-family: monospace;
  }

  .performance-cta {
    display: block;
    text-decoration: none;
    text-align: center;
    padding: 12px 16px 8px 16px;
    margin-top: 1rem;
    background: rgba(0, 170, 255, 0.1);
    border: 1px solid rgba(0, 170, 255, 0.15);
    border-radius: 16px;
    cursor: pointer;
    transition:
      background-color 0.2s ease,
      border-color 0.2s ease;
  }

  .performance-cta:hover {
    background: rgba(0, 170, 255, 0.08);
    border-color: rgba(0, 170, 255, 0.25);
  }

  .lazy-cards {
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .performance-cta small {
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: 500;
    display: block;
    line-height: 1.4;
  }

  .performance-cta .percentile-text {
    color: var(--accent-primary);
    font-weight: 500;
  }

  .performance-cta .verify-text {
    color: var(--accent-primary);
    font-weight: 500;
  }

  @media (max-width: 640px) {
    .performance-cta .percentile-text {
      font-size: 0.875rem;
    }

    .metrics-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .lighthouse-value {
      font-size: 1.25rem;
      margin-bottom: 1px;
    }

    .metric-value {
      margin-bottom: 1px;
    }
  }

  /* Extra small mobile - prevent overflow with single optimized query */
  @media (max-width: 480px) {
    .metrics-grid {
      grid-template-columns: 1fr; /* Single column for better mobile performance */
      gap: 8px;
    }

    .metric-item,
    .lighthouse-score {
      padding: 8px 4px;
      font-size: 0.5625rem;
    }

    .lighthouse-value,
    .metric-value {
      font-size: 1rem;
    }
  }

  /* Performance metrics container */
  .performance-metrics {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 0.5rem;
  }

  /* Homepage-specific styles only - LinkedIn styles moved to blog page */
</style>

<!-- Pure CSS animations - no JavaScript needed -->
